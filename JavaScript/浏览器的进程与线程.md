# 浏览器的进程与线程

##  概念

进程是操作系统资源分配和调度的最小单位，线程是程序运行的最小单位。一个进程中可以有一个或多个线程，进程之间内存相互独立，进程中的这些线程可以共享内存空间。

## 浏览器进程

现代浏览器使用多进程模式。主要有：

- 浏览器主进程

  负责浏览器的地址栏，书签栏，前进后退按钮等。

  不可见的底层行为，例如网络请求，文件访问。

- 渲染进程

  负责浏览器的渲染，事件处理，脚本运行。每开启一个Tab页（iframe也是）就会启动一个渲染进程。渲染进程中是多线程的，包括：

  - GUI线程：负责浏览器的界面，当GUI更新会保存在队列中，等JS引擎空闲立即执行更新GUI，重绘和重排时就会执行此线程。
  - JS引擎线程：负责执行JavaScript脚本，等待任务队列中任务到来，然后加以处理，一个Tab页只有一个JS先线程在运行。
  - 定时触发线程：`setTimeout`，`setInterval`方法。注：这两个方法不是JS引擎实现的，是浏览器实现的，JS只是调用它们。W3C规定`setTimeout`时间最少4ms。
  - 事件触发线程：负责处理浏览器事件触发，例如当浏览器触发点击事件、执行`setTimeout`、发送Ajax请求，该线程就会将事件放入任务队列里面等待JS引擎处理。
  - 异步http请求线程：处理 Ajax请求。

  > 以执行`setTimeout(function(){console.log(111)},2000)`为例
  >
  > JS引擎线程执行代码，执行到`setTimeout`时，因为是定时器所以有交给定时触发线程处理，2000ms后事件触发（可以理解为“onDone”事件），事件触发线程将事件放入任务队列，当JS引擎空闲执行回调函数，打印出111。

- GPU进程：负责硬件加速，3D绘制。

- 第三方插件进程，每启用一个插件就会开启一个进程。

> 问什么JS引擎是单线程的？
>
> 答：
>
> 1. JS设计之初是为了解决表单验证，对功能性要求不高。
>
> 2. JS如果设计成多线程，多个线程操作同于一个DOM元素时，该听谁的，虽然可以加锁，但是会提高复杂度，权衡之下所以就设计成单线程了。

